{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport auth from '@/plugins/auth';\nimport router, { constantRoutes, dynamicRoutes } from '@/router';\nimport { getRouters } from '@/api/menu';\nimport Layout from '@/layout/index';\nimport ParentView from '@/components/ParentView';\nimport InnerLink from '@/layout/components/InnerLink';\nconst permission = {\n  state: {\n    routes: [],\n    addRoutes: [],\n    defaultRoutes: [],\n    topbarRouters: [],\n    sidebarRouters: []\n  },\n  mutations: {\n    SET_ROUTES: (state, routes) => {\n      state.addRoutes = routes;\n      state.routes = constantRoutes.concat(routes);\n    },\n    SET_DEFAULT_ROUTES: (state, routes) => {\n      state.defaultRoutes = constantRoutes.concat(routes);\n    },\n    SET_TOPBAR_ROUTES: (state, routes) => {\n      state.topbarRouters = routes;\n    },\n    SET_SIDEBAR_ROUTERS: (state, routes) => {\n      state.sidebarRouters = routes;\n    }\n  },\n  actions: {\n    // 生成路由\n    GenerateRoutes({\n      commit\n    }) {\n      return new Promise(resolve => {\n        // 向后端请求路由数据\n        getRouters().then(res => {\n          const sdata = JSON.parse(JSON.stringify(res.data));\n          const rdata = JSON.parse(JSON.stringify(res.data));\n          const sidebarRoutes = filterAsyncRouter(sdata);\n          const rewriteRoutes = filterAsyncRouter(rdata, false, true);\n          const asyncRoutes = filterDynamicRoutes(dynamicRoutes);\n          rewriteRoutes.push({\n            path: '*',\n            redirect: '/404',\n            hidden: true\n          });\n          router.addRoutes(asyncRoutes);\n          commit('SET_ROUTES', rewriteRoutes);\n          commit('SET_SIDEBAR_ROUTERS', constantRoutes.concat(sidebarRoutes));\n          commit('SET_DEFAULT_ROUTES', sidebarRoutes);\n          commit('SET_TOPBAR_ROUTES', sidebarRoutes);\n          resolve(rewriteRoutes);\n        });\n      });\n    }\n  }\n};\n\n// 遍历后台传来的路由字符串，转换为组件对象\nfunction filterAsyncRouter(asyncRouterMap, lastRouter = false, type = false) {\n  return asyncRouterMap.filter(route => {\n    if (type && route.children) {\n      route.children = filterChildren(route.children);\n    }\n    if (route.component) {\n      // Layout ParentView 组件特殊处理\n      if (route.component === 'Layout') {\n        route.component = Layout;\n      } else if (route.component === 'ParentView') {\n        route.component = ParentView;\n      } else if (route.component === 'InnerLink') {\n        route.component = InnerLink;\n      } else {\n        route.component = loadView(route.component);\n      }\n    }\n    if (route.children != null && route.children && route.children.length) {\n      route.children = filterAsyncRouter(route.children, route, type);\n    } else {\n      delete route['children'];\n      delete route['redirect'];\n    }\n    return true;\n  });\n}\nfunction filterChildren(childrenMap, lastRouter = false) {\n  var children = [];\n  childrenMap.forEach((el, index) => {\n    if (el.children && el.children.length) {\n      if (el.component === 'ParentView' && !lastRouter) {\n        el.children.forEach(c => {\n          c.path = el.path + '/' + c.path;\n          if (c.children && c.children.length) {\n            children = children.concat(filterChildren(c.children, c));\n            return;\n          }\n          children.push(c);\n        });\n        return;\n      }\n    }\n    if (lastRouter) {\n      el.path = lastRouter.path + '/' + el.path;\n    }\n    children = children.concat(el);\n  });\n  return children;\n}\n\n// 动态路由遍历，验证是否具备权限\nexport function filterDynamicRoutes(routes) {\n  const res = [];\n  routes.forEach(route => {\n    if (route.permissions) {\n      if (auth.hasPermiOr(route.permissions)) {\n        res.push(route);\n      }\n    } else if (route.roles) {\n      if (auth.hasRoleOr(route.roles)) {\n        res.push(route);\n      }\n    }\n  });\n  return res;\n}\nexport const loadView = view => {\n  if (process.env.NODE_ENV === 'development') {\n    return resolve => require([`@/views/${view}`], resolve);\n  } else {\n    // 使用 import 实现生产环境的路由懒加载\n    return () => import(`@/views/${view}`);\n  }\n};\nexport default permission;","map":{"version":3,"names":["auth","router","constantRoutes","dynamicRoutes","getRouters","Layout","ParentView","InnerLink","permission","state","routes","addRoutes","defaultRoutes","topbarRouters","sidebarRouters","mutations","SET_ROUTES","concat","SET_DEFAULT_ROUTES","SET_TOPBAR_ROUTES","SET_SIDEBAR_ROUTERS","actions","GenerateRoutes","commit","Promise","resolve","then","res","sdata","JSON","parse","stringify","data","rdata","sidebarRoutes","filterAsyncRouter","rewriteRoutes","asyncRoutes","filterDynamicRoutes","push","path","redirect","hidden","asyncRouterMap","lastRouter","type","filter","route","children","filterChildren","component","loadView","length","childrenMap","forEach","el","index","c","permissions","hasPermiOr","roles","hasRoleOr","view","process","env","NODE_ENV","require"],"sources":["D:/Code/authpage/src/store/modules/permission.js"],"sourcesContent":["import auth from '@/plugins/auth'\r\nimport router, { constantRoutes, dynamicRoutes } from '@/router'\r\nimport { getRouters } from '@/api/menu'\r\nimport Layout from '@/layout/index'\r\nimport ParentView from '@/components/ParentView'\r\nimport InnerLink from '@/layout/components/InnerLink'\r\n\r\nconst permission = {\r\n  state: {\r\n    routes: [],\r\n    addRoutes: [],\r\n    defaultRoutes: [],\r\n    topbarRouters: [],\r\n    sidebarRouters: []\r\n  },\r\n  mutations: {\r\n    SET_ROUTES: (state, routes) => {\r\n      state.addRoutes = routes\r\n      state.routes = constantRoutes.concat(routes)\r\n    },\r\n    SET_DEFAULT_ROUTES: (state, routes) => {\r\n      state.defaultRoutes = constantRoutes.concat(routes)\r\n    },\r\n    SET_TOPBAR_ROUTES: (state, routes) => {\r\n      state.topbarRouters = routes\r\n    },\r\n    SET_SIDEBAR_ROUTERS: (state, routes) => {\r\n      state.sidebarRouters = routes\r\n    },\r\n  },\r\n  actions: {\r\n    // 生成路由\r\n    GenerateRoutes({ commit }) {\r\n      return new Promise(resolve => {\r\n        // 向后端请求路由数据\r\n        getRouters().then(res => {\r\n          const sdata = JSON.parse(JSON.stringify(res.data))\r\n          const rdata = JSON.parse(JSON.stringify(res.data))\r\n          const sidebarRoutes = filterAsyncRouter(sdata)\r\n          const rewriteRoutes = filterAsyncRouter(rdata, false, true)\r\n          const asyncRoutes = filterDynamicRoutes(dynamicRoutes);\r\n          rewriteRoutes.push({ path: '*', redirect: '/404', hidden: true })\r\n          router.addRoutes(asyncRoutes);\r\n          commit('SET_ROUTES', rewriteRoutes)\r\n          commit('SET_SIDEBAR_ROUTERS', constantRoutes.concat(sidebarRoutes))\r\n          commit('SET_DEFAULT_ROUTES', sidebarRoutes)\r\n          commit('SET_TOPBAR_ROUTES', sidebarRoutes)\r\n          resolve(rewriteRoutes)\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\n// 遍历后台传来的路由字符串，转换为组件对象\r\nfunction filterAsyncRouter(asyncRouterMap, lastRouter = false, type = false) {\r\n  return asyncRouterMap.filter(route => {\r\n    if (type && route.children) {\r\n      route.children = filterChildren(route.children)\r\n    }\r\n    if (route.component) {\r\n      // Layout ParentView 组件特殊处理\r\n      if (route.component === 'Layout') {\r\n        route.component = Layout\r\n      } else if (route.component === 'ParentView') {\r\n        route.component = ParentView\r\n      } else if (route.component === 'InnerLink') {\r\n        route.component = InnerLink\r\n      } else {\r\n        route.component = loadView(route.component)\r\n      }\r\n    }\r\n    if (route.children != null && route.children && route.children.length) {\r\n      route.children = filterAsyncRouter(route.children, route, type)\r\n    } else {\r\n      delete route['children']\r\n      delete route['redirect']\r\n    }\r\n    return true\r\n  })\r\n}\r\n\r\nfunction filterChildren(childrenMap, lastRouter = false) {\r\n  var children = []\r\n  childrenMap.forEach((el, index) => {\r\n    if (el.children && el.children.length) {\r\n      if (el.component === 'ParentView' && !lastRouter) {\r\n        el.children.forEach(c => {\r\n          c.path = el.path + '/' + c.path\r\n          if (c.children && c.children.length) {\r\n            children = children.concat(filterChildren(c.children, c))\r\n            return\r\n          }\r\n          children.push(c)\r\n        })\r\n        return\r\n      }\r\n    }\r\n    if (lastRouter) {\r\n      el.path = lastRouter.path + '/' + el.path\r\n    }\r\n    children = children.concat(el)\r\n  })\r\n  return children\r\n}\r\n\r\n// 动态路由遍历，验证是否具备权限\r\nexport function filterDynamicRoutes(routes) {\r\n  const res = []\r\n  routes.forEach(route => {\r\n    if (route.permissions) {\r\n      if (auth.hasPermiOr(route.permissions)) {\r\n        res.push(route)\r\n      }\r\n    } else if (route.roles) {\r\n      if (auth.hasRoleOr(route.roles)) {\r\n        res.push(route)\r\n      }\r\n    }\r\n  })\r\n  return res\r\n}\r\n\r\nexport const loadView = (view) => {\r\n  if (process.env.NODE_ENV === 'development') {\r\n    return (resolve) => require([`@/views/${view}`], resolve)\r\n  } else {\r\n    // 使用 import 实现生产环境的路由懒加载\r\n    return () => import(`@/views/${view}`)\r\n  }\r\n}\r\n\r\nexport default permission\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}